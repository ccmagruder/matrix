// Copyright 2023 Caleb Magruder

/*
Benchmark Matrix Multiply

The benchmark measures wall clock time of multiplying two square matrices.
    ./benchmark -n100
*/

#include <chrono>
#include <iostream>
#include <string>

#include "Matrix.h"

#include "benchmark/benchmark.h"

#cmakedefine01 USE_ACC
#cmakedefine01 USE_OPB
#cmakedefine01 USE_MKL

template <BLAS T>
void matrixSquared(benchmark::State& state) {
    const int N = state.range(0);
    Matrix<T> A(N, N);
    for (auto _ : state) {
        Matrix<T> B = A * A;
    }
}

BENCHMARK_TEMPLATE(matrixSquared, REF)->Range(4, 256);

#if USE_ACC
BENCHMARK_TEMPLATE(matrixSquared, ACC)->Range(4, 256);
#endif

#if USE_OPB
BENCHMARK_TEMPLATE(matrixSquared, OPB)->Range(4, 256);
#endif

#if USE_MKL
BENCHMARK_TEMPLATE(matrixSquared, MKL)->Range(4, 256);
#endif

BENCHMARK_MAIN();
